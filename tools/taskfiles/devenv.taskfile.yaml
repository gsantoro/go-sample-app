version: '3'

# Changie
# ----------------------------------------------------------------
# Docs at https://changie.dev/
#
# note: run from ../Taskfile.yaml

tasks:
  deps:
    cmds:
      - sh <(curl -L https://nixos.org/nix/install)
      - nix-env -iA cachix -f https://cachix.org/api/v1/install
      - cachix use devenv
      - nix-env -if https://github.com/cachix/devenv/tarball/latest

      # direnv: setup https://direnv.net/docs/hook.html
      - brew install direnv

  init:
    cmds:
      - devenv init

  shell:
    cmds:
      - devenv shell

  up:
    cmds:
      - devenv up

  # Note: t devenv:search -- gofmt
  search:
    cmds:
      - devenv search {{.CLI_ARGS}}

  reload:
    cmds: 
      - direnv allow && direnv reload
